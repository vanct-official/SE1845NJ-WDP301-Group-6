name: GitHub → Telegram Notify

on:
  push:
  pull_request:
  release:
    types: [published]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Send notification to Telegram
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          TELEGRAM_THREAD_ID: ${{ secrets.TELEGRAM_THREAD_ID }}
        run: |
          TIMESTAMP=$(date +"%Y-%m-%d %H:%M:%S")

          if [ "${{ github.event_name }}" = "push" ]; then
            ACTOR="${{ github.actor }}"
            BRANCH="${{ github.ref_name }}"
            COMMIT_MSG="${{ github.event.head_commit.message }}"
            TITLE="Push"

            TEXT=$'*WDP301 - Group 8*\nTime stamp: '"$TIMESTAMP"$'\nTitle: '"$TITLE"$'\nDear team,\nActor: '"$ACTOR"$'\nBranch: '"$BRANCH"$'\nCommit: '"$COMMIT_MSG"$'\n\nRegard!'

          elif [ "${{ github.event_name }}" = "pull_request" ]; then
            ACTOR="${{ github.actor }}"
            FROM_BRANCH="${{ github.head_ref }}"
            TO_BRANCH="${{ github.base_ref }}"
            PR_TITLE="${{ github.event.pull_request.title }}"
            TITLE="Pull Request"

            TEXT=$'*WDP301 - Group 8*\nTime stamp: '"$TIMESTAMP"$'\nTitle: '"$TITLE"$'\nDear team,\nActor: '"$ACTOR"$'\nBranch: '"$FROM_BRANCH"' → '"$TO_BRANCH"$'\nCommit: '"$PR_TITLE"$'\n\nRegard!'

          elif [ "${{ github.event_name }}" = "release" ]; then
            ACTOR="${{ github.actor }}"
            RELEASE_TAG="${{ github.event.release.tag_name }}"
            RELEASE_NAME="${{ github.event.release.name }}"
            TITLE="Release"

            TEXT=$'*WDP301 - Group 8*\nTime stamp: '"$TIMESTAMP"$'\nTitle: '"$TITLE"$'\nDear team,\nActor: '"$ACTOR"$'\nBranch: main\nCommit: '"$RELEASE_TAG"' - '"$RELEASE_NAME"$'\n\nRegard!'
          fi

          curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage" \
            -d chat_id="${TELEGRAM_CHAT_ID}" \
            -d message_thread_id="${TELEGRAM_THREAD_ID}" \
            -d parse_mode="Markdown" \
            -d text="$TEXT"
